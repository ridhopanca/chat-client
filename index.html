<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Login page realtime chat</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
		integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
		crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/fontawesome.min.css"
		integrity="sha512-xX2rYBFJSj86W54Fyv1de80DWBq7zYLn2z0I9bIhQG+rxIF6XVJUpdGnsNHWRa6AvP89vtFupEPDP8eZAtu9qA=="
		crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body style="background-image:
	url('https://img.freepik.com/free-photo/abstract-blue-geometric-shapes-background_24972-1841.jpg?t=st=1656571284~exp=1656571884~hmac=9fbd8973e858806156d20d84eb60716bd1aab9352fb364f04fe0cfb26c4abe7e&w=1060');
	background-repeat: no-repeat; background-attachment: fixed; background-position: center; background-size: cover;">
	<section>
		<div class="d-flex justify-content-center mt-5">
			<div class="col-lg-4">
				<div class="card">
					<div class="card-header text-center">
						<i class="fa-brands fa-rocketchat fa-5x"></i>
					</div>
					<div class="card-body p-4">
						<form id="formLogin">
							<div class="mb-3">
								<label for="exampleFormControlInput1" class="form-label">Username</label>
								<input type="text" name="username" class="form-control" id="exampleFormControlInput1" />
							</div>
							<div class="d-grid ">
								<button type="button" id="btnClick" class="btn btn-dark btn-block">Login</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</section>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/js/fontawesome.min.js"
		integrity="sha512-5qbIAL4qJ/FSsWfIq5Pd0qbqoZpk5NcUVeAAREV2Li4EKzyJDEGlADHhHOSSCw0tHP7z3Q4hNHJXa81P92borQ=="
		crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/js/all.min.js"
		integrity="sha512-6PM0qYu5KExuNcKt5bURAoT6KCThUmHRewN3zUFNaoI6Di7XJPTMoT6K0nsagZKk2OB4L7E3q1uQKHNHd4stIQ=="
		crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js"
		integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk" crossorigin="anonymous">
	</script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.min.js"
		integrity="sha384-kjU+l4N0Yf4ZOJErLsIcvOU2qSb74wXpOhqTvwVx3OElZRweTnQ6d31fXEoRD1Jy" crossorigin="anonymous">
	</script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script>
		let urlHost = 'http://10.10.11.155:3000/'; //change with your local server

		$("#btnClick").on('click', function () {
			const input = $('input[name=username]').val();
			const datax = {
				name: input
			};
			$.ajax({
				url: urlHost + 'api/users/search',
				headers: {
					'Content-type': 'application/json'
				},
				method: 'POST',
				dataType: 'json',
				data: JSON.stringify(datax),
				success: function (response) {
					const user = response.user;
					const names = user.firstName + ' ' + user.lastName;
					const userId = user._id;
					$.ajax({
						url: urlHost + 'api/login/' + userId,
						method: 'POST',
						dataType: 'json',
						success: function (response) {
							const auth = response.authorization;
							localStorage.setItem('chatAuth', auth);
							localStorage.setItem('chatUserName', names);
							localStorage.setItem('chatUserId', userId);
							document.location = './home.html';
						},
						error: function (xhr) {
							alert(xhr.responseJSON.message);
						}
					})
				},
				error: function (xhr) {
					alert(xhr.responseJSON.error.error);
				}

			})
		});
	</script>

</body>

</html>