<!DOCTYPE html>
<html>
<head>
	<title>Login page realtime chat</title>
</head>
<body>
	<div>
		<form id="formLogin">
			<div>
				<label>Username</label>
				<input type="text" name="username" />
				<button type="button" id="btnClick">Login</button>
			</div>
		</form>
	</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
	let  urlHost = 'http://10.10.11.155:3000/'; //change with your local server

	$("#btnClick").on('click', function(){
		const input = $('input[name=username]').val();
		const datax = { name: input };
		$.ajax({
			url: urlHost + 'api/users/search',
			headers: {'Content-type':'application/json'},
			method: 'POST',
			dataType: 'json',
			data: JSON.stringify(datax), 
			success: function(response) {
				const user = response.user;
				const names = user.firstName + ' ' + user.lastName;
				const userId = user._id;
				$.ajax({
					url : urlHost + 'api/login/' + userId,
					method : 'POST',
					dataType: 'json',
					success: function(response){
						const auth = response.authorization;
						localStorage.setItem('chatAuth', auth);
						localStorage.setItem('chatUserName', names);
						localStorage.setItem('chatUserId', userId);
						document.location = './home.html';
					},
					error: function(xhr){
						alert(xhr.responseJSON.message);
					}
				})
			},
			error: function(xhr){
				alert(xhr.responseJSON.error.error);
			}

		})
	});
</script>

</body>
</html>
